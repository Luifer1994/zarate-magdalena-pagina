---
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/Navigation.astro";

import zarateData from "../data/zarate.json";

const { history } = zarateData.content;
---

<Layout
  title={`Historia - ${zarateData.site_config.title}`}
  image={history.hero_image}
>
  <Navigation />

  <main>
    <!-- Page Hero -->
    <section
      class="relative h-[60vh] flex items-center justify-center overflow-hidden"
    >
      <div class="absolute inset-0 z-0">
        <img
          src={history.hero_image}
          alt="Historia Z√°rate"
          class="w-full h-full object-cover page-hero-bg scale-110"
        />
        <div
          class="absolute inset-0 bg-gradient-to-b from-black/60 to-zarate-earth/80 mix-blend-multiply"
        >
        </div>
      </div>
      <div class="relative z-10 text-center text-white max-w-4xl px-4 mt-16">
        <span
          class="text-zarate-green font-bold tracking-widest uppercase mb-4 block animate-fade-in"
          >{history.hero_tag}</span
        >
        <h1
          class="font-serif text-5xl md:text-7xl mb-6 leading-tight animate-fade-in delay-100"
        >
          {history.title}
        </h1>
        <p
          class="text-lg md:text-xl text-white/90 max-w-2xl mx-auto font-light animate-fade-in delay-200"
        >
          {history.subtitle}
        </p>
      </div>
      <div class="wave-bottom">
        <svg
          data-name="Layer 1"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1200 120"
          preserveAspectRatio="none"
        >
          <path
            d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"
            fill="#F0F9FF"></path>
        </svg>
      </div>
    </section>

    <!-- Intro Section -->
    <div class="max-w-4xl mx-auto px-6 text-center">
      <p
        class="text-2xl font-serif text-zarate-blue leading-relaxed gsap-fade-up mb-12"
        set:html={history.intro}
      />
      <div
        class="text-lg text-slate-600 leading-relaxed text-justify gsap-fade-up"
      >
        <p set:html={history.origins_text} />
      </div>
    </div>
  </main>

  <!-- Timeline Section -->
  <section class="py-20 bg-white relative">
    <div class="max-w-5xl mx-auto px-6">
      <div
        class="relative border-l-4 border-zarate-earth/20 ml-6 md:ml-auto md:mr-auto md:w-full md:max-w-3xl space-y-16"
      >
        {
          history.timeline.map((event, index) => (
            <div class="relative pl-12 md:pl-0 timeline-item">
              <div class="absolute left-[-10px] top-0 w-6 h-6 bg-zarate-earth rounded-full border-4 border-white shadow-md md:left-1/2 md:-ml-3 z-10" />

              <div
                class={`md:w-1/2 ${index % 2 === 0 ? "md:pr-12 md:text-right md:ml-0" : "md:pl-12 md:ml-auto"}`}
              >
                <span class="inline-block bg-zarate-green/10 text-zarate-green font-bold px-3 py-1 rounded-full text-sm mb-2">
                  {event.year || event.era}
                </span>
                <h3 class="text-2xl font-serif text-zarate-blue mb-3 font-bold">
                  {event.title}
                </h3>
                <p class="text-slate-600 leading-relaxed">
                  {event.description}
                </p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Sacred Sites -->
  <section class="py-24 bg-zarate-earth/5 relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-6">
      <h2
        class="text-4xl font-serif text-center text-zarate-earth mb-16 gsap-fade-up"
      >
        {history.section_title_sites}
      </h2>

      <div class="grid md:grid-cols-3 gap-8">
        {
          history.sites.map((site, index) => (
            <div class="bg-white p-8 rounded-[2rem] shadow-lg hover:-translate-y-2 transition-transform duration-300 border-t-4 border-zarate-earth site-card opacity-0 translate-y-10">
              <div class="w-16 h-16 bg-zarate-earth/10 rounded-full flex items-center justify-center mb-6 text-3xl">
                üèõÔ∏è
              </div>
              <h3 class="text-2xl font-serif text-zarate-blue mb-4">
                {site.name}
              </h3>
              <p class="text-slate-600">{site.description}</p>
            </div>
          ))
        }
      </div>
    </div>
  </section>
</Layout>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("astro:page-load", () => {
    // Check if we are on the history page (or a page with .page-hero-bg)
    if (!document.querySelector(".page-hero-bg")) return;

    // Hero Parallax
    gsap.to(".page-hero-bg", {
      scrollTrigger: {
        trigger: "main",
        start: "top top",
        end: "bottom top",
        scrub: true,
      },
      y: 50,
      scale: 1.05,
    });

    // Fade Up Elements
    const fadeUpElements = gsap.utils.toArray(".gsap-fade-up");
    if (fadeUpElements.length > 0) {
      fadeUpElements.forEach((element: any) => {
        gsap.fromTo(
          element,
          { y: 30, opacity: 0 },
          {
            scrollTrigger: {
              trigger: element,
              start: "top 85%",
              toggleActions: "play none none reverse",
            },
            y: 0,
            opacity: 1,
            duration: 1,
            ease: "power3.out",
          }
        );
      });
    }

    // Timeline Items
    const timelineItems = gsap.utils.toArray(".timeline-item");
    if (timelineItems.length > 0) {
      timelineItems.forEach((element: any) => {
        gsap.fromTo(
          element,
          { opacity: 0, y: 30 },
          {
            scrollTrigger: {
              trigger: element,
              start: "top 80%",
            },
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: "power3.out",
          }
        );
      });
    }

    // Site Cards Stagger
    const siteCards = document.querySelectorAll(".site-card");
    if (siteCards.length > 0) {
      gsap.fromTo(
        ".site-card",
        { y: 50, opacity: 0 },
        {
          scrollTrigger: {
            trigger: ".site-card",
            start: "top 80%",
          },
          y: 0,
          opacity: 1,
          duration: 0.8,
          stagger: 0.2,
          ease: "back.out(1.7)",
        }
      );
    }
  });
</script>
